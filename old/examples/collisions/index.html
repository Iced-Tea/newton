<!DOCTYPE html>
<html>
<head>
  <title>Newton.js: Collisions Example</title>
  <link rel='stylesheet' type='text/css' href='../shared/style.css' />
</head>
<body>

<div class='wrap'>
  <ul class='stats'>
    <li>fps:<span id='fps'></span></li>
    <li>particles:<span id='particles'></span></li>
    <li>edges:<span id='edges'></span></li>
    <li>constraints:<span id='constraints'></span></li>
    <li>forces:<span id='forces'></span></li>
  </ul>
  <canvas id="display" width="1280" height="450"></canvas>
</div>

<script type="text/javascript" src="../../bower_components/jquery/jquery.js"></script>
<script type='text/javascript' src='../../newton.js'></script>

<script>

  var renderer = Newton.GLRenderer(document.getElementById('display')),
      sim = Newton.Simulator(undefined, renderer.callback, 60, 100, 1),
      gravity = Newton.LinearGravity(0, 0.002, 0),
      container = Newton.BoxConstraint(0, 0, 1280, 450),
      boxes = createBoxes(100, 100, 850, 100, 5),
      line = createLine(0, 400, 400, 400),
      segments = createSegments(400, 400, 800, 400, 5),
      spike1 = createSpike(950, 350, 100),
      box1 = Newton.Box(950, 50, 40),
      spike2 = createSpike(1150, 350, 100),
      box2 = Newton.Box(1170, 50, 40);

  sim
    .add([gravity, container])
    .add(boxes)
    .add([line, segments])
    .add([spike1, box1, spike2, box2])
    .start();

  setInterval(showStats, 250);

  function showStats(time) {
    $('#fps').text(sim.fps);
    $('#particles').text(sim.particles.length);
    $('#edges').text(sim.edges.length);
    $('#constraints').text(sim.constraints.length);
    $('#forces').text(sim.forces.length);
  }

  function createSpike(x, y, size) {
    var body = Newton.Body();
    var a = body.Particle(x - size, y + size).pin();
    var b = body.Particle(x, y).pin();
    var c = body.Particle(x + size, y + size).pin();
    body.Edge(a, b);
    body.Edge(b, c);
    return body;
  }

  function createBoxes(x1, y1, x2, y2, count) {
    var boxes = [];
    var xSpace = (x2 - x1) / count;
    var ySpace = (y2 - y1) / count;

    for (var i = 0; i < count; i++) {
      boxes.push(Newton.Box(x1 + i * xSpace, y1 + i * ySpace, 25));
    }

    return boxes;
  }

  function createLine(x1, y1, x2, y2) {
    var body = Newton.Body();
    var a = body.Particle(x1, y1);
    var b = body.Particle(x2, y2);
    body.Edge(a, b);
    a.pin();
    b.pin()
    return body;
  }

  function createSegments(x1, y1, x2, y2, count) {
    var body = Newton.Body();
    var xSpace = (x2 - x1) / count;
    var ySpace = (y2 - y1) / count;

    for (var i = 0; i < count; i++) {
      body.Particle(x1 + i * xSpace, y1 + i * ySpace).pin();
      if (i > 0) body.Edge(body.particles[i - 1], body.particles[i]);
    }
    body.Particle(x2, y2).pin();
    body.Edge(body.particles[count - 1], body.particles[count]);

    return body;
  }

</script>

</body>